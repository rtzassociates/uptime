<div id="task">
  <div class="headline pull-left">
    <h1><%= @task.name %>
      <% if @task.unassigned? %>
        <span class="badge badge-info">Unassigned Task</span>
      <% end %>
      <% if @task.completed? %>
        <span class="badge badge-success">Completed</span>
      <% end %>  
    </h1>
  </div>
    
  <div class="pull-right" style="margin-top:1em">
    <% if current_user.has_accepted? @task %>
      <%= render "user_tasks/unaccept", :task_id => @task.id %>
    <% else %>
      <%= render "user_tasks/accept", :task_id => @task.id %>
    <% end %>
  </div>
  
  <div class="clearfix"></div>
  
  <p class="muted">
    Created by <%= link_to @task.user.username, @task.user %> on <%= @task.created_at.strftime('%b %e, %Y at %l:%M %p') %>
     (<%= time_ago_in_words(@task.created_at).capitalize %> ago) &#183;
      <%= users_assigned_to task %>
  </p>
  <p><%= markdown @task.description %></p>
  <div class="actions">
    <ul>
      <% if allow? "tasks", "edit" %>
        <li><%= link_to 'Edit', edit_task_path(@task) %></li>
      <% end %>
      <% if allow? "services", "destroy" %>
        <li><%= link_to 'Destroy', @task, :method => :delete, :data => { :confirm => "Are you sure?" }, :class => "danger" %></li>
      <% end %>
    </ul>
  </div>
  <br />
  
  <div id="task_notes">
    <% unless @task.task_notes.empty? %>
      <div id="task_notes">
        <div class="task_note-top"></div>
        <%= render @task.task_notes %>
      </div>
    <% end %>
    <div id="task_note" class="form">
      <%= form_for TaskNote.new do |f| %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= f.hidden_field :task_id, :value => @task.id %>
        <%= f.text_area :content, :placeholder => "Make a note about this task", :rows => 3 %>
        <div class="actions pull-right">
        <%= f.submit "Submit Note", :class => 'btn'%>
        </div>
      <% end %> 
    </div>      
  </div>
  
  <div id="completion">
    <% if @task.completed? %>
        <h3>Completion Details</h3>
        <p class="muted">Completed by <%= link_to @task.completion.user.username, @task.completion.user %> on <%= @task.completion.created_at.strftime('%b %e, %Y at %l:%M %p') %>
         (<%= time_ago_in_words(@task.completion.created_at).capitalize %> ago)
        <p><%= markdown @task.completion.description %></p>
        <div class="actions">
          <ul>
            <% if allow? "completions", "edit" %>
              <li><%= link_to 'Edit', edit_task_completion_path(@task) %></li>
            <% end %>
            <% if allow? "completions", "destroy" %>
              <li><%= link_to 'Destroy', @task.completion, :method => :delete, :data => { :confirm => "Are you sure?" }, :class => "danger" %></li>
            <% end %>
          </ul>
        </div>
        <br />
    <% else %>
      <%= link_to "Mark As Completed", new_task_completion_path(@task), :class => "btn btn-large btn-success" %>
    <% end %>
  </div>
</div>